import { Injectable } from '@angular/core';

@Injectable()
export class TextService {
  private bookFragments: string[];

  bookText: string = `Władysław Stanisław Reymont

Chłopi
Część pierwsza — Jesień

ISBN 978-83-288-2723-3




Miriamowi
(Zenonowi Przesmyckiemu)



I

— Niech będzie pochwalony Jezus Chrystus!

— Na wieki wieków, moja Agato, a dokąd to wędrujecie, co?

— We świat, do ludzi, dobrodzieju kochany — w tyli świat!… — zakreśliła kijaszkiem łuk od wschodu do zachodu.

Ksiądz spojrzał bezwiednie w tę dal i rychło przywarł oczy, bo nad zachodem wisiało oślepiające słońce; a potem spytał ciszej, lękliwiej jakby…

— Wypędzili was Kłębowie, co? A może to ino niezgoda?… może…

Nie zaraz odrzekła, wyprostowała się nieco, powlekła ciężko starymi, wypełzłymi oczami po polach ojesieniałych, pustych i po dachach wsi zanurzonej w sadach.

— I… nie wypędzali… jakżeby… dobre są ludzie — krewniaki. Niezgody też nijakiej być nie było. Samam ino zmiarkowała, że trza mi w świat. Z cudzego woza to złaź choć i w pół morza.

Trza było… roboty już la mnie nie miały… na zimę idzie, to jakże — darmo mi to dadzą warzę abo i ten kąt do spania?…

A że rychtyk i ciołka odsadzili od maci… a i gąski, bo to już zimne nocki, trza zagnać pod strzechę, tom i zrobiła miejsce… jakże, bydlątek szkoda, Boże stworzenie też… A ludzie dobre, bo mię choć latem przytulą, kąta ani tej łyżki strawy nie żałują, że se człowiek kiej jaka gospodyni paraduje…

A na zimę we świat, po proszonym.

Niewiela mi potrza, to se u dobrych ludzi uproszę i do zwiesny z Panajezusową łaską przechyrlam, a jeszcze się coś niecoś grosza uścibi — to rychtyk la nich na przednówek… krewniaki przeciech…

A już ta Jezusiczek przenajsłodszy biedoty opuścić nie opuści.

— Nie opuści, nie — zawołał gorąco i wstydliwie wsadził jej w garść złotówkę.

— Dobrodzieju nasz serdeczny, dobrodzieju!

Przypadła mu do kolan roztrzęsioną głową, a łzy jak groch posypały się po jej twarzy szarej i zradlonej jak te jesienne podorówki.

— Idźcie z Bogiem, idźcie — szeptał zakłopotany podnosząc ją z ziemi.

Zebrała drżącymi rękami torby i kijaszek z jeżem na końcu, przeżegnała się i poszła szeroką, wyboistą drogą ku lasom; raz wraz tylko odwracała się ku wsi, ku polom, na których kopano kartofle, i na te dymy pastusich ognisk, co się snuły nisko nad ścierniskami — poglądała żałośnie, aż i zniknęła za przydrożnymi krzami.

A ksiądz usiadł z powrotem na kółkach od pługa, zażył tabaki i rozłożył brewiarz, ale oczy ześlizgiwały mu się z czerwonych liter i leciały po ogromnych, w jesiennej zadumie pogrążonych ziemiach, to po bladym niebie błądziły lub zatrzymywały się na parobku, pochylonym nad pługiem.

— Walek… bruzda krzywa… te… — zawołał unosząc się nieco i chodził już oczami krok za krokiem za parą tłustych siwków, ciągnących pług ze skrzypem.

Zaczął znowu bezwiednie przebiegać czerwone litery brewiarza i poruszać ustami, ale co chwila gonił oczami siwki, to stadko wron, które ostrożnie, z wyciągniętymi dziobami podskakiwały w bruździe i raz wraz, za każdym świstem bata, za każdym nawrotem pługa, podrywały się ciężko, padały zaraz na zorane zagony i ostrzyły dzioby o twarde, zeschłe skiby.

— Walek! a śmignij no prawą po portkach, bo zostaje!

Uśmiechnął się, bo jakoż po bacie prawa już równo ciągnęła, a gdy konie doszły do drogi, uniósł się żywo, poklepał je przyjaźnie po karkach, aż wyciągały do niego nozdrza i przyjacielsko obwąchiwały twarz.

— Heeet–aa! — wołał śpiewnie Walek, wyciągnął błyszczący jakby ze srebra pług, uniósł go lekko, pociągnął konie lejcami, że zatoczyły krótki łuk, wraził krój błyszczący w rżysko, śmignął batem, konie pociągły z miejsca, aż zgrzytnęły orczyki — i orał dalej wielki łan ziemi, co pod prostym kątem spadał od drogi po pochyłości i niby długi wątek zgrzebnych skib rozciągał się aż ku wsi, leżącej nisko i jakby zatopionej w czerwonawych i żółtawych sadach.

Cicho było, ciepło i nieco sennie.

Słońce, chociaż to był już koniec września, przygrzewało jeszcze niezgorzej — wisiało w połowie drogi między południem a zachodem, nad lasami, że już krze i kamionki, i grusze po polach, a nawet zeschłe twarde skiby kładły za się cienie mocne i chłodne.

Cisza była na polach opustoszałych i upajająca słodkość w powietrzu, przymglonym kurzawą słoneczną; na wysokim, bladym błękicie leżały gdzieniegdzie bezładnie porozrzucane ogromne białe chmury niby zwały śniegów, nawiane przez wichry i postrzępione.

A pod nimi, jak okiem ogarnąć, leżały szare pola niby olbrzymia misa o modrych wrębach lasów — misa, przez którą, jak srebrne przędziwo rozbłysłe w słońcu, migotała się w skrętach rzeka spod olch i łozin nadbrzeżnych. Wzbierała w pośrodku wsi w ogromny podłużny staw i uciekała na północ wyrwą wśród pagórków; na dnie kotliny, dokoła stawu, leżała wieś i grała w słońcu jesiennymi barwami sadów — niby czerwono–żółta liszka, zwinięta na szarym liściu łopianu, od której do lasów wyciągało się długie, splątane nieco przędziwo zagonów, płachty pól szarych, sznury miedz pełnych kamionek i tarnin — tylko gdzieniegdzie w tej srebrnawej szarości rozlewały się strugi złota — łubiny żółciły się kwiatem pachnącym, to bielały omdlałe, wyschłe łożyska strumieni albo leżały piaszczyste senne drogi i nad nimi rzędy potężnych topoli z wolna wspinały się na wzgórza i pochylały ku lasom.

Ksiądz ocknął się z zapatrzenia, bo długi, żałosny ryk rozległ się gdzieś niedaleko, aż wrony poderwały się z krzykiem i skośnym rzutem leciały na kopaniska — a czarny migocący cień biegł za nimi dołem po rżyskach i podorówkach.

Przysłonił ręką oczy i patrzył pod słońce — drogą od lasów szła jakaś dziewczyna i ciągnęła za sobą na postronku dużą, czerwoną krowę; gdy przechodziła obok, pochwaliła Boga i chciała skręcić, aby księdza pocałować w rękę, ale krowa szarpnęła ją w bok i znowu ryczeć zaczęła.

— Na sprzedanie prowadzisz, co?

— Ni… ino do młynarzowego bysia… a stójże, zapowietrzona… Wściekłaś się czy co! — wołała zadyszana, usiłując powstrzymać, ale krowa ją pociągnęła, że już obie gnały w dyrdy, aż kurz je zakrył obłokiem.

A potem wlókł się ciężko po piaszczystej drodze Żyd szmaciarz, pchał przed sobą taczki dobrze naładowane, bo raz wraz przysiadał i ciężko dyszał.

— Co tam słychać, Moszku?

— Co słychać?… Komu dobrze, to i dobrze słychać… Kartofle chwała Bogu obrodziły, żyto sypie, kapusta będzie. Kto ma kartofle, kto ma żyto, kto ma kapustę — temu dobrze słychać! — Pocałował księdza w rękaw, założył na kark pas od taczek i pchał dalej, lżej już, bo zaczynał się spadek łagodny.

A potem szedł środkiem drogi w kurzawie, bo zamiatał nogami, ślepy dziad prowadzony przez tłustego kundla na sznurku.

A potem leciał od lasu chłopak z butelką, ale ten ujrzawszy księdza przy drodze okrążył go z dala i biegł na przełaj pól do karczmy.

To znowu chłop z sąsiedniej wsi wiózł zboże do młyna albo Żydówka pędziła stado kupionych gęsi.

A każdy pochwalił Boga, zamienił słów parę i szedł w swoją drogę, odprowadzany życzliwym słowem i spojrzeniem księdza, któren, że już słońce było coraz niżej, powstał i krzyknął do Walka:

— Doórz do brzózek i do domu… na nic się konie zmachają.

I poszedł wolno miedzami, odmawiał półgłosem modlitwy i jasnym, pełnym kochania spojrzeniem ogarniał pola…

…Rzędy kobiet czerwieniły się na kopaniskach… rozlegał się grochot zsypywanych do wozów kartofli… miejscami orano jeszcze pod siew… stada krów srokatych pasły się na ugorach… długie, popielate zagony rdzawiły się młodą szczotką zbóż wschodzących… to gęsi niby płaty śniegów bieliły się na wytartych, zrudziałych łąkach… krowa gdzieś zaryczała… ogniska się paliły i długie, niebieskie warkocze dymów ciągnęły się nad zagonami… Wóz zaturkotał albo pług zgrzytnął o kamienie… to cisza znowu obejmowała ziemię na chwilę, że słychać było głuchy bełkot rzeki i turkot młyna, schowanego za wsią, w zbitym gąszczu drzew pożółkłych… to znowu śpiewka się zerwała lub krzyk nie wiadomo skąd powstały leciał nisko, tłukł się po bruzdach i dołach i tonął bez echa w jesiennej szarości, na ścierniskach oprzędzonych srebrnymi pajęczynami, w pustych sennych drogach, nad którymi pochylały się jarzębiny o krwawych, ciężkich głowach… to włóczono role i tuman szarego, przesłonecznionego kurzu podnosił się za bronami, wydłużał i pełzał aż na wzgórze i opadał, a spod niego niby z obłoku wychylał się bosy chłop, z gołą głową, przewiązany płachtą — szedł wolno, nabierał ziarna z płachty i siał ruchem monotonnym, nabożnym i błogosławiącym ziemi, dochodził do końca zagonów, nabierał z worka zboża, nawracał i z wolna podchodził pod wzgórze, że najpierw głowa rozczochrana, potem ramiona, a w końcu już był cały widny na tle słońca z tym samym błogosławiącym ruchem siejby; z tym samym świętym rzutem rozrzucał zboże, co jak złoty pył kolistym wirem padało na ziemię.
`;

  bookFragmentsWithNewlines: string[] = [];

  constructor() {
    this.bookFragments = this.splitByNewlines(this.bookText);
    this.wordFragments = this.bookFragments.filter(
      (frag) => !this.isNewline(frag)
    );

    let fragments: string[] = [];
    let piped: string = this.bookText.replace(/[,.?!;…]+/g, '$&|');
    piped = piped.replace(/\S+$/gm, '$&|');
    piped = piped.replace(/(?<!^)—/gm, '$&|');
    fragments = this.splitByNewlines(piped);
    fragments = this.splitByPipes(fragments);
    fragments = this.splitLongFragments(fragments);
    this.bookFragmentsWithNewlines = [...fragments];
    fragments = this.removeNewlines(fragments);
    this.bookFragments = fragments;
    this.wordFragments = fragments;
  }

  getBookFragments(): string[] {
    return this.bookFragments;
  }

  getBookFragmentsWithNewlines(): string[] {
    return this.bookFragmentsWithNewlines;
  }

  private wordFragments: string[];

  getWordFragments(): string[] {
    return this.wordFragments;
  }

  splitTextByNWords(text: string, n: number) {
    const words = text.split(/[^\S\r\n]/);
    const groups = [];

    for (let i = 0; i < words.length; i += n) {
      const group = words.slice(i, i + n).join(' ');
      groups.push(group);
    }

    return groups;
  }

  splitByNewlines(text: string): string[] {
    return text.split(/(\n+)/);
  }

  isNewline(phrase: string): boolean {
    return /^\n+/.test(phrase);
  }

  removeNewlines(fragments: string[]): string[] {
    return fragments.filter((frag) => !this.isNewline(frag));
  }

  splitByPipes(fragments: string[]): string[] {
    let result: string[] = [];
    fragments.forEach(frag => {
      const split = frag.split(/\|+/);
      result = result.concat(split);
    })
    
    result = result.filter(el => el !== '');
    return result
  }

  splitLongFragments(fragments: string[]): string[] {
    let result: string[] = [];
    fragments.forEach(frag => {
      const split = this.splitTextByNWords(frag, 4);
      result = result.concat(split);

    })
    return result
  }

}
